name: Build and Run Elgg

on:
  push:
    branches:
      - main

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Build Docker image
        run: docker-compose build

      - name: Run Elgg container
        run: docker-compose up -d

      - name: Wait for Elgg to start
        run: sleep 30

      - name: Check Elgg availability
        run: |
          status_code=$(curl -s -o /dev/null -w "%{http_code}" http://localhost)
          if [ $status_code -eq 200 ]; then
            echo "Elgg is running successfully."
          else
            echo "Failed to access Elgg. Status code: $status_code"
            exit 1
          fi

      # Add additional steps for functional testing if needed
      # - name: Run Elgg functional tests
      #   run: |
      #     # Your functional tests commands here
